# notchprompt_flutter

A cross-platform desktop teleprompter. Lives in the system tray — no Dock icon,
no taskbar entry. Displays a floating transparent overlay that scrolls your
script at a configurable speed.

See [CHANGELOG.md](../CHANGELOG.md) for release history.

## Install

> Download the latest release from [GitHub Releases](https://github.com/saif0200/notchprompt/releases).

### macOS
1. Open the DMG and drag **Notchprompt.app** to `/Applications`
2. First launch: right-click → **Open** (Gatekeeper bypass for unsigned builds)
3. The app appears in the **menu bar** — no Dock icon

### Linux (Ubuntu 22.04+ / Debian)
```bash
sudo apt install ./notchprompt-*-linux-amd64.deb
```
Requires `libayatana-appindicator3-1`. On GNOME install the **AppIndicator**
shell extension if the tray icon does not appear.

### Windows
1. Extract `notchprompt-*-windows-x64.zip`
2. Run `notchprompt.exe`
3. The app appears in the **system tray**

---

## Platforms

| Platform | Status |
|---|---|
| macOS | 1.0.0 ✅ |
| Linux | 1.0.0 ✅ |
| Windows | 1.0.0 ✅ |

## Development

See [AGENTS.md](../AGENTS.md) for contributor and AI agent guidelines.
See [docs/ROADMAP.md](../docs/ROADMAP.md) for current phase and work queue.

### Quick start

```bash
flutter pub get
dart run build_runner build
flutter run -d macos   # or linux / windows
```

---

## macOS Distribution

### Ad-hoc build (unsigned, dev/testing)

```bash
# From repo root
./scripts/build_release_dmg.sh v1.0.0
# Output: dist/notchprompt-flutter-v1.0.0-macos.dmg
```

Users opening an ad-hoc-signed DMG will need to right-click → Open the first
time to bypass Gatekeeper's unidentified developer warning.

### Signed + notarized build (distribution)

Requires an Apple Developer account with a **Developer ID Application**
certificate installed in your keychain.

```bash
export APPLE_ID="you@example.com"
export APP_SPECIFIC_PASSWORD="xxxx-xxxx-xxxx-xxxx"   # App-Specific Password from appleid.apple.com
export APPLE_TEAM_ID="XXXXXXXXXX"                    # 10-character Team ID

./scripts/build_release_dmg.sh v1.0.0 \
  --sign "Developer ID Application: Your Name (XXXXXXXXXX)"
```

The script will:
1. `flutter build macos --release`
2. Code-sign with `--options runtime` (Hardened Runtime required for notarization)
3. Package into a DMG with an `/Applications` symlink
4. Submit to Apple's notary service and wait for approval
5. Staple the notarization ticket to the DMG

### Entitlements

`macos/Runner/Release.entitlements` is generated by Flutter. If you need to add
entitlements (e.g. for file access beyond the sandbox), edit that file before
building.

### Privacy mode note

Privacy mode (`NSWindow.sharingType = .none`) prevents the overlay from
appearing in screen captures and recordings. It is enabled by default and
controlled from the tray menu and settings. It is a macOS-only feature and
silently no-ops on Linux/Windows.

---

## Linux Distribution

### Prerequisites

```bash
sudo apt install cmake ninja-build clang libgtk-3-dev pkg-config \
     libayatana-appindicator3-dev   # required for tray_manager on GNOME/Unity
```

### Build + package

```bash
# From repo root — produces both .deb and AppImage in dist/
./scripts/build_release_linux.sh v1.0.0

# .deb only
./scripts/build_release_linux.sh v1.0.0 --deb

# AppImage only (linuxdeploy downloaded automatically to /tmp on first run)
./scripts/build_release_linux.sh v1.0.0 --appimage
```

### System tray notes

| Desktop Environment | Tray support | Notes |
|---|---|---|
| GNOME (Ubuntu 22.04+) | ✅ via AppIndicator | Install `gnome-shell-extension-appindicator` if icons don't appear |
| KDE Plasma | ✅ native | Works out of the box |
| XFCE / LXDE | ✅ native | Works out of the box |
| GNOME (Wayland, no extension) | ⚠️ | Tray icon may not appear; use X11 session as workaround |

`tray_manager` on Linux uses `libayatana-appindicator3`. The package must be
installed on the target machine. The `.deb` control file lists it as a
dependency; AppImage users may need to install it manually.

### HiDPI / scaling

Flutter on Linux respects the GDK scaling factor (`GDK_SCALE`,
`GDK_DPI_SCALE`). On HiDPI displays text and UI are rendered at the correct
density automatically. If the overlay appears too small or too large, adjust
`GDK_SCALE=2` in the launch environment.

### Multi-monitor

The overlay is positioned at the top-center of the **primary display** (the one
reported as index 0 by `window_manager`). On Linux this is the monitor marked
as primary in the display settings of your DE. Running on a monitor that is not
the primary requires no configuration change — `window_manager.getSize()` is
called after positioning to verify the placement.

---

## Windows Distribution

### Prerequisites

- Flutter Windows desktop support (included in the Flutter SDK)
- [Visual Studio 2022](https://visualstudio.microsoft.com/) with the
  **Desktop development with C++** workload

### Build + package

```bat
REM From repo root (Git Bash / MSYS2):
./scripts/build_release_windows.sh v1.0.0            # produces .zip
./scripts/build_release_windows.sh v1.0.0 --msix     # MSIX (needs Windows SDK)
./scripts/build_release_windows.sh v1.0.0 --zip --msix   # both
```

The `.zip` is a portable, no-install distribution. Extract and run
`notchprompt.exe`.

### MSIX signing

For side-loading or Store submission, the MSIX must be signed:

```powershell
# Self-signed cert (testing only):
New-SelfSignedCertificate -Type Custom -Subject "CN=NotchpromptContributors" `
    -KeyUsage DigitalSignature -FriendlyName "Notchprompt" `
    -CertStoreLocation "Cert:\CurrentUser\My"

signtool sign /fd SHA256 /a dist\notchprompt-v1.0.0-windows-x64.msix
```

For distribution, use an EV Code Signing certificate from a trusted CA.

### Tray icon

The tray icon uses the `tray_manager` package which reads the PNG from
`assets/tray_icon.png`. Windows scales the PNG automatically; replace it
with a 256×256 RGBA PNG for best results at all DPI levels.

### HiDPI / scaling

The runner manifest (`windows/runner/runner.exe.manifest`) declares
`PerMonitorV2` DPI awareness — Flutter handles rendering at native DPI
automatically. No additional configuration is required.

### Multi-monitor

Same as Linux: the overlay is anchored to the top-center of the primary
monitor (`window_manager` index 0). This corresponds to the monitor set as
the main display in Windows Display Settings.

